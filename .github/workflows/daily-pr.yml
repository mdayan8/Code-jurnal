name: Daily Pull Request with Varying Patterns

on:
  schedule:
    - cron: '30 0 * * *'  # Runs daily at 00:30 UTC (offset from main commit)
  workflow_dispatch:  # Allows manual triggering

permissions:
  contents: write
  pull-requests: write

jobs:
  create-daily-pr:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Set up Git
      run: |
        git config --global user.name "mdayan8-bot"
        git config --global user.email "mdayanbag+bot@gmail.com"

    - name: Generate daily activity pattern
      id: pattern
      run: |
        # Get current day of week (0=Sunday, 1=Monday, etc.)
        DAY_OF_WEEK=$(date +%w)
        # Get current day of month
        DAY_OF_MONTH=$(date +%d)
        # Get current month
        MONTH=$(date +%m)
        
        # Create varying patterns based on different factors
        ACTIVITY_LEVEL="medium"
        PATTERN_TYPE="standard"
        
        # Low activity days (Sundays, and random days)
        if [ $DAY_OF_WEEK -eq 0 ] || [ $((DAY_OF_MONTH % 7)) -eq 0 ]; then
          ACTIVITY_LEVEL="low"
          PATTERN_TYPE="minimal"
        
        # High activity days (Fridays, mid-month days)
        elif [ $DAY_OF_WEEK -eq 5 ] || [ $DAY_OF_MONTH -eq 15 ] || [ $((DAY_OF_MONTH % 3)) -eq 0 ]; then
          ACTIVITY_LEVEL="high"
          PATTERN_TYPE="intensive"
        
        # Medium activity with random variation
        elif [ $((DAY_OF_MONTH % 2)) -eq 0 ]; then
          ACTIVITY_LEVEL="medium"
          PATTERN_TYPE="balanced"
        fi
        
        # Add some randomness based on month
        if [ $((MONTH % 2)) -eq 0 ]; then
          PATTERN_TYPE="${PATTERN_TYPE}_alt"
        fi
        
        echo "activity_level=$ACTIVITY_LEVEL" >> $GITHUB_OUTPUT
        echo "pattern_type=$PATTERN_TYPE" >> $GITHUB_OUTPUT
        echo "day_of_week=$DAY_OF_WEEK" >> $GITHUB_OUTPUT
        echo "Activity level: $ACTIVITY_LEVEL, Pattern: $PATTERN_TYPE"

    - name: Create branch for PR
      run: |
        BRANCH_NAME="daily-updates/$(date +'%Y-%m-%d')-${{ steps.pattern.outputs.pattern_type }}"
        git checkout -b "$BRANCH_NAME"
        echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

    - name: Generate daily content based on pattern
      run: |
        DATE_STR=$(date +'%Y-%m-%d')
        TIME_STR=$(date +'%H:%M UTC')
        ACTIVITY_LEVEL="${{ steps.pattern.outputs.activity_level }}"
        PATTERN_TYPE="${{ steps.pattern.outputs.pattern_type }}"
        
        # Create activities based on pattern
        case $ACTIVITY_LEVEL in
          "low")
            # Minimal activity - just basic logging
            echo "" >> daily_activities.md
            echo "## ğŸ“… $DATE_STR - Quiet Day" >> daily_activities.md
            echo "- ğŸ•’ Daily check-in at $TIME_STR" >> daily_activities.md
            echo "- ğŸ“ Minimal updates today" >> daily_activities.md
            COMMIT_COUNT=1
            ;;
          
          "medium")
            # Medium activity - regular updates
            echo "" >> daily_activities.md
            echo "## ğŸ“… $DATE_STR - Regular Day" >> daily_activities.md
            echo "- ğŸ•’ Daily check-in at $TIME_STR" >> daily_activities.md
            echo "- ğŸ’» Code review and maintenance" >> daily_activities.md
            echo "- ğŸ“š Documentation updates" >> daily_activities.md
            echo "- ğŸ”§ Minor improvements" >> daily_activities.md
            COMMIT_COUNT=3
            ;;
          
          "high")
            # High activity - lots of work
            echo "" >> daily_activities.md
            echo "## ğŸ“… $DATE_STR - Productive Day" >> daily_activities.md
            echo "- ğŸ•’ Early start at $TIME_STR" >> daily_activities.md
            echo "- ğŸš€ New feature development" >> daily_activities.md
            echo "- ğŸ› Bug fixes and improvements" >> daily_activities.md
            echo "- ğŸ“– Code documentation" >> daily_activities.md
            echo "- ğŸ” Code review sessions" >> daily_activities.md
            echo "- ğŸ§ª Testing and validation" >> daily_activities.md
            echo "- ğŸ“Š Performance optimizations" >> daily_activities.md
            COMMIT_COUNT=6
            ;;
        esac
        
        # Also update the main daily.md with pattern info
        echo "ğŸ•’ $DATE_STR $TIME_STR - $ACTIVITY_LEVEL activity ($PATTERN_TYPE)" >> daily.md
        
        echo "COMMIT_COUNT=$COMMIT_COUNT" >> $GITHUB_ENV

    - name: Make multiple commits based on activity level
      run: |
        git add daily.md daily_activities.md
        git commit -m "ğŸ“… Daily update: $(date +'%Y-%m-%d') - ${{ steps.pattern.outputs.activity_level }} activity"
        
        # Make additional commits based on activity level
        for i in $(seq 2 $COMMIT_COUNT); do
          case $i in
            2)
              echo "- ğŸ”„ Progress update #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ”„ Progress update #$i - ongoing work"
              ;;
            3)
              echo "- âœ… Milestone #$i completed at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "âœ… Milestone #$i - feature completion"
              ;;
            4)
              echo "- ğŸ”§ Refactoring session #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ”§ Refactoring #$i - code improvements"
              ;;
            5)
              echo "- ğŸ“ Documentation update #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ“ Documentation #$i - adding details"
              ;;
            6)
              echo "- ğŸ¯ Final touches #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ¯ Final touches #$i - polishing work"
              ;;
          esac
          sleep 2  # Small delay between commits
        done

    - name: Push branch
      run: |
        git push origin "$BRANCH_NAME"

    - name: Create Pull Request
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        ACTIVITY_LEVEL="${{ steps.pattern.outputs.activity_level }}"
        PATTERN_TYPE="${{ steps.pattern.outputs.pattern_type }}"
        DATE_STR=$(date +'%Y-%m-%d')
        
        # Create different PR titles and descriptions based on activity level
        case $ACTIVITY_LEVEL in
          "low")
            TITLE="ğŸ“ Daily Update - Quiet Day ($DATE_STR)"
            BODY="## ğŸŒ… Daily Log - Minimal Activity

Just a quick check-in for today. Keeping things light and simple.

### Changes:
- Basic daily logging
- Routine maintenance

**Activity Level:** Low ğŸ”½
**Pattern:** $PATTERN_TYPE
**Commits:** $COMMIT_COUNT"
            ;;
          
          "medium")
            TITLE="ğŸ“Š Daily Progress - Regular Work Day ($DATE_STR)"
            BODY="## ğŸ—ï¸ Daily Log - Steady Progress

Regular development day with consistent progress across multiple areas.

### Changes:
- Daily activity logging
- Code maintenance and reviews
- Documentation updates
- General improvements

**Activity Level:** Medium âš–ï¸
**Pattern:** $PATTERN_TYPE
**Commits:** $COMMIT_COUNT"
            ;;
          
          "high")
            TITLE="ğŸš€ Daily Sprint - High Productivity Day ($DATE_STR)"
            BODY="## âš¡ Daily Log - Intensive Work Session

High-energy day with significant progress across multiple fronts!

### Changes:
- ğŸš€ New feature development
- ğŸ› Bug fixes and improvements  
- ğŸ“– Comprehensive documentation
- ğŸ” Thorough code reviews
- ğŸ§ª Testing and validation
- ğŸ“Š Performance optimizations

**Activity Level:** High ğŸ”¥
**Pattern:** $PATTERN_TYPE
**Commits:** $COMMIT_COUNT

This was a particularly productive day with multiple significant achievements!"
            ;;
        esac
        
        # Create the pull request
        gh pr create \
          --title "$TITLE" \
          --body "$BODY" \
          --base main \
          --head "$BRANCH_NAME" \
          --label "daily-update,automated,$ACTIVITY_LEVEL-activity"