name: Daily Pull Request with Varying Patterns

on:
  schedule:
    - cron: '30 0 * * *'  # Runs daily at 00:30 UTC (offset from main commit)
  workflow_dispatch:  # Allows manual triggering

permissions:
  contents: write
  pull-requests: write

jobs:
  create-daily-pr:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Set up Git
      run: |
        git config --global user.name "mdayan8-bot"
        git config --global user.email "mdayanbag+bot@gmail.com"

    - name: Generate realistic activity pattern
      id: pattern
      run: |
        # Get current day info for realistic patterns
        DAY_OF_WEEK=$(date +%w)  # 0=Sunday, 1=Monday, etc.
        DAY_OF_MONTH=$(date +%d)
        MONTH=$(date +%m)
        YEAR=$(date +%Y)
        
        # Create a seed for pseudo-randomness based on date
        SEED=$((YEAR + MONTH * 31 + DAY_OF_MONTH * 7 + DAY_OF_WEEK))
        RANDOM_NUM=$((SEED % 100))
        
        # Default to no activity (realistic!)
        ACTIVITY_LEVEL="none"
        PATTERN_TYPE="skip"
        SHOULD_SKIP="true"
        
        # Realistic human patterns:
        # - 40% chance of no activity (weekends, busy days, breaks)
        # - 35% chance of light activity 
        # - 20% chance of medium activity
        # - 5% chance of high activity
        
        if [ $RANDOM_NUM -lt 40 ]; then
          # 40% - No activity (realistic human behavior)
          ACTIVITY_LEVEL="none"
          PATTERN_TYPE="offline"
          SHOULD_SKIP="true"
          
          # But make weekends even more likely to be inactive
          if [ $DAY_OF_WEEK -eq 0 ] || [ $DAY_OF_WEEK -eq 6 ]; then
            if [ $RANDOM_NUM -lt 70 ]; then
              SHOULD_SKIP="true"
            fi
          fi
          
        elif [ $RANDOM_NUM -lt 75 ]; then
          # 35% - Light activity
          ACTIVITY_LEVEL="low"
          PATTERN_TYPE="minimal"
          SHOULD_SKIP="false"
          
        elif [ $RANDOM_NUM -lt 95 ]; then
          # 20% - Medium activity  
          ACTIVITY_LEVEL="medium"
          PATTERN_TYPE="regular"
          SHOULD_SKIP="false"
          
        else
          # 5% - High activity (rare productive days)
          ACTIVITY_LEVEL="high"
          PATTERN_TYPE="productive"
          SHOULD_SKIP="false"
        fi
        
        # Add some realistic weekly patterns
        # Monday blues - more likely to skip
        if [ $DAY_OF_WEEK -eq 1 ] && [ $((RANDOM_NUM % 3)) -eq 0 ]; then
          SHOULD_SKIP="true"
          ACTIVITY_LEVEL="none"
          PATTERN_TYPE="monday_blues"
        fi
        
        # Friday energy - more likely to be active
        if [ $DAY_OF_WEEK -eq 5 ] && [ $SHOULD_SKIP = "true" ] && [ $((RANDOM_NUM % 2)) -eq 0 ]; then
          SHOULD_SKIP="false"
          ACTIVITY_LEVEL="medium"
          PATTERN_TYPE="friday_push"
        fi
        
        # Month-end crunch - higher activity
        if [ $DAY_OF_MONTH -gt 28 ] && [ $SHOULD_SKIP = "true" ] && [ $((RANDOM_NUM % 3)) -eq 0 ]; then
          SHOULD_SKIP="false"
          ACTIVITY_LEVEL="high"
          PATTERN_TYPE="month_end_crunch"
        fi
        
        # Add variety to pattern names
        PATTERN_SUFFIX=$((RANDOM_NUM % 3 + 1))
        PATTERN_TYPE="${PATTERN_TYPE}_v${PATTERN_SUFFIX}"
        
        echo "activity_level=$ACTIVITY_LEVEL" >> $GITHUB_OUTPUT
        echo "pattern_type=$PATTERN_TYPE" >> $GITHUB_OUTPUT
        echo "should_skip=$SHOULD_SKIP" >> $GITHUB_OUTPUT
        echo "day_of_week=$DAY_OF_WEEK" >> $GITHUB_OUTPUT
        echo "random_num=$RANDOM_NUM" >> $GITHUB_OUTPUT
        
        if [ "$SHOULD_SKIP" = "true" ]; then
          echo "ğŸš« Skipping today - No activity (realistic pattern)"
        else
          echo "âœ… Activity planned - Level: $ACTIVITY_LEVEL, Pattern: $PATTERN_TYPE"
        fi

    - name: Check if should skip today
      id: skip_check
      run: |
        if [ "${{ steps.pattern.outputs.should_skip }}" = "true" ]; then
          echo "ğŸš« Skipping today's activity - creating realistic gap in contributions"
          echo "skip=true" >> $GITHUB_OUTPUT
          exit 0
        else
          echo "âœ… Proceeding with today's activity"
          echo "skip=false" >> $GITHUB_OUTPUT
        fi

    - name: Create branch for PR
      if: steps.skip_check.outputs.skip == 'false'
      run: |
        BRANCH_NAME="daily-updates/$(date +'%Y-%m-%d')-${{ steps.pattern.outputs.pattern_type }}"
        git checkout -b "$BRANCH_NAME"
        echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

    - name: Generate daily content based on pattern
      if: steps.skip_check.outputs.skip == 'false'
      run: |
        DATE_STR=$(date +'%Y-%m-%d')
        TIME_STR=$(date +'%H:%M UTC')
        ACTIVITY_LEVEL="${{ steps.pattern.outputs.activity_level }}"
        PATTERN_TYPE="${{ steps.pattern.outputs.pattern_type }}"
        
        # Create activities based on pattern
        case $ACTIVITY_LEVEL in
          "low")
            # Minimal activity - just basic logging
            echo "" >> daily_activities.md
            echo "## ğŸ“… $DATE_STR - Light Work Day" >> daily_activities.md
            echo "- ğŸ•’ Quick check-in at $TIME_STR" >> daily_activities.md
            echo "- ğŸ“ Small updates and fixes" >> daily_activities.md
            echo "- â˜• Taking it easy today" >> daily_activities.md
            COMMIT_COUNT=1
            ;;
          
          "medium")
            # Medium activity - regular updates
            echo "" >> daily_activities.md
            echo "## ğŸ“… $DATE_STR - Steady Progress" >> daily_activities.md
            echo "- ğŸ•’ Work session started at $TIME_STR" >> daily_activities.md
            echo "- ğŸ’» Code review and maintenance" >> daily_activities.md
            echo "- ğŸ“š Documentation updates" >> daily_activities.md
            echo "- ğŸ”§ Several improvements implemented" >> daily_activities.md
            echo "- ğŸ¯ Good progress on current tasks" >> daily_activities.md
            COMMIT_COUNT=3
            ;;
          
          "high")
            # High activity - lots of work
            echo "" >> daily_activities.md
            echo "## ğŸ“… $DATE_STR - High Energy Day" >> daily_activities.md
            echo "- ğŸ•’ Early productive start at $TIME_STR" >> daily_activities.md
            echo "- ğŸš€ Major feature development" >> daily_activities.md
            echo "- ğŸ› Multiple bug fixes and improvements" >> daily_activities.md
            echo "- ğŸ“– Comprehensive documentation work" >> daily_activities.md
            echo "- ğŸ” Thorough code review sessions" >> daily_activities.md
            echo "- ğŸ§ª Extensive testing and validation" >> daily_activities.md
            echo "- ğŸ“Š Performance optimizations" >> daily_activities.md
            echo "- âš¡ Really in the zone today!" >> daily_activities.md
            COMMIT_COUNT=5
            ;;
        esac
        
        # Also update the main daily.md with pattern info
        echo "ğŸ•’ $DATE_STR $TIME_STR - $ACTIVITY_LEVEL activity ($PATTERN_TYPE)" >> daily.md
        
        echo "COMMIT_COUNT=$COMMIT_COUNT" >> $GITHUB_ENV

    - name: Make multiple commits based on activity level
      if: steps.skip_check.outputs.skip == 'false'
      run: |
        git add daily.md daily_activities.md
        git commit -m "ğŸ“… Daily update: $(date +'%Y-%m-%d') - ${{ steps.pattern.outputs.activity_level }} activity"
        
        # Make additional commits based on activity level
        for i in $(seq 2 $COMMIT_COUNT); do
          case $i in
            2)
              echo "- ğŸ”„ Progress update #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ”„ Progress update #$i - ongoing work"
              ;;
            3)
              echo "- âœ… Milestone #$i completed at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "âœ… Milestone #$i - feature completion"
              ;;
            4)
              echo "- ğŸ”§ Refactoring session #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ”§ Refactoring #$i - code improvements"
              ;;
            5)
              echo "- ğŸ“ Documentation update #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ“ Documentation #$i - adding details"
              ;;
            6)
              echo "- ğŸ¯ Final touches #$i at $(date +'%H:%M')" >> daily_activities.md
              git add daily_activities.md
              git commit -m "ğŸ¯ Final touches #$i - polishing work"
              ;;
          esac
          sleep 2  # Small delay between commits
        done

    - name: Push branch
      if: steps.skip_check.outputs.skip == 'false'
      run: |
        git push origin "$BRANCH_NAME"

    - name: Create Pull Request
      if: steps.skip_check.outputs.skip == 'false'
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        ACTIVITY_LEVEL="${{ steps.pattern.outputs.activity_level }}"
        PATTERN_TYPE="${{ steps.pattern.outputs.pattern_type }}"
        DATE_STR=$(date +'%Y-%m-%d')
        
        # Create different PR titles and descriptions based on activity level
        case $ACTIVITY_LEVEL in
          "low")
            TITLE="ğŸ“ Daily Update - Quiet Day ($DATE_STR)"
            BODY="## ğŸŒ… Daily Log - Minimal Activity

Just a quick check-in for today. Keeping things light and simple.

### Changes:
- Basic daily logging
- Routine maintenance

**Activity Level:** Low ğŸ”½
**Pattern:** $PATTERN_TYPE
**Commits:** $COMMIT_COUNT"
            ;;
          
          "medium")
            TITLE="ğŸ“Š Daily Progress - Regular Work Day ($DATE_STR)"
            BODY="## ğŸ—ï¸ Daily Log - Steady Progress

Regular development day with consistent progress across multiple areas.

### Changes:
- Daily activity logging
- Code maintenance and reviews
- Documentation updates
- General improvements

**Activity Level:** Medium âš–ï¸
**Pattern:** $PATTERN_TYPE
**Commits:** $COMMIT_COUNT"
            ;;
          
          "high")
            TITLE="ğŸš€ Daily Sprint - High Productivity Day ($DATE_STR)"
            BODY="## âš¡ Daily Log - Intensive Work Session

High-energy day with significant progress across multiple fronts!

### Changes:
- ğŸš€ New feature development
- ğŸ› Bug fixes and improvements  
- ğŸ“– Comprehensive documentation
- ğŸ” Thorough code reviews
- ğŸ§ª Testing and validation
- ğŸ“Š Performance optimizations

**Activity Level:** High ğŸ”¥
**Pattern:** $PATTERN_TYPE
**Commits:** $COMMIT_COUNT

This was a particularly productive day with multiple significant achievements!"
            ;;
        esac
        
        # Create the pull request
        gh pr create \
          --title "$TITLE" \
          --body "$BODY" \
          --base main \
          --head "$BRANCH_NAME" \
          --label "daily-update,automated,$ACTIVITY_LEVEL-activity"